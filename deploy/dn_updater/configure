#!/bin/bash
DN_HOME=`pwd`
UPDATER=$DN_HOME/updater_restarter

updater_gen() {
  touch $UPDATER
  chmod +x $UPDATER
  echo "kill -9 \$(ps aux|grep dn_updater/dn_updater|grep -v vim|grep -v java|grep -v grep|awk '{print \$2}')" > $UPDATER
  echo "$DN_HOME/dn_updater -host $HOST -brokers $BROKERS -etcd $ETCD -domain tyd.svc.cluster.local &" >> $UPDATER
}

case $1 in
  "updater")
    if [ "$#" -ne 5 ]; then
      echo "Illegal number of parameters, expected 5, got $#"
    fi
    HOST=$2
    BROKERS=$3
    ETCD=$4
    updater_gen
    ;;
  *)
    echo "Usage: $0 updater <host ip> <broker list seperated by comma> <etcd ip:port> <iface>"
    ;;
esac


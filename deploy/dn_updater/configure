#!/bin/bash
DN_HOME=`pwd`
UPDATER=$DN_HOME/updater_restarter

updater_gen() {
  touch $UPDATER
  chmod +x $UPDATER
  echo "kill -9 \$(ps aux|grep dn_updater/dn_updater|grep -v vim|grep -v java|grep -v grep|awk '{print \$2}')" > $UPDATER
  echo "$DN_HOME/dn_updater -host $HOST -brokers $BROKERS -etcd $ETCD -redirect $REDIRECT &" >> $UPDATER
}

watchlist_gen() {
  echo "$DN_HOME/dn_updater -host $HOST -brokers $BROKERS -etcd $ETCD -redirect $REDIRECT" | sudo tee -a $WATCHLIST
}

case $1 in
  "updater")
    if [ "$#" -ne 6 ]; then
      echo "Illegal number of parameters, expected 6, got $#"
    fi
    WATCHLIST=$2
    HOST=$3
    BROKERS=$4
    ETCD=$5
    REDIRECT=$6
    updater_gen
    watchlist_gen
    ;;
  *)
    echo "Usage: $0 updater <host ip> <broker list seperated by comma> <etcd ip:port> <redirect IP>"
    ;;
esac

